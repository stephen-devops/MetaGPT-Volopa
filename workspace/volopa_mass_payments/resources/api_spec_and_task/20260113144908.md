## Required packages

- league/csv
- spatie/laravel-query-builder
- laravel/sanctum

## Required Other language third-party packages

- No other language dependencies required

## Logic Analysis

- ['database/migrations/create_mass_payment_files_table.php', 'Creates mass_payment_files table schema with status tracking and audit fields']
- ['database/migrations/create_payment_instructions_table.php', 'Creates payment_instructions table with foreign key to mass_payment_files table']
- ['app/Models/MassPaymentFile.php', 'Eloquent model for mass payment files with relationships to PaymentInstruction and User models']
- ['app/Models/PaymentInstruction.php', 'Eloquent model for individual payment instructions with relationship to MassPaymentFile and Beneficiary']
- ['app/Models/Beneficiary.php', 'Eloquent model for payment recipients with client scoping']
- ['app/Models/TccAccount.php', 'Eloquent model for client funding accounts']
- ['app/Policies/MassPaymentFilePolicy.php', 'Authorization logic for mass payment file operations, depends on User and MassPaymentFile models']
- ['app/Http/Requests/UploadMassPaymentFileRequest.php', 'Validation rules for file uploads, depends on MassPaymentFilePolicy for authorization']
- ['app/Http/Requests/ApproveMassPaymentFileRequest.php', 'Validation rules for payment file approval, depends on MassPaymentFilePolicy']
- ['app/Http/Requests/GetPaymentInstructionsRequest.php', 'Request validation for payment instruction queries, depends on policies']
- ['config/mass-payments.php', 'Configuration file for mass payment system settings like file limits and validation rules']
- ['app/Services/MassPaymentFileService.php', 'Core business logic for file operations, depends on models and validation service']
- ['app/Services/CsvValidationService.php', 'CSV parsing and validation logic, depends on models for data validation']
- ['app/Services/PaymentProcessingService.php', 'Payment processing business logic, depends on models and external payment APIs']
- ['app/Services/TemplateService.php', 'Template generation logic, depends on Beneficiary model for recipient data']
- ['app/Jobs/ValidateMassPaymentFileJob.php', 'Async job for CSV validation, depends on CsvValidationService and models']
- ['app/Jobs/ProcessPaymentInstructionsJob.php', 'Async job for payment processing, depends on PaymentProcessingService']
- ['app/Notifications/PaymentFileApprovalNotification.php', 'Notification class for approval workflow, depends on MassPaymentFile model']
- ['app/Http/Middleware/VolopaAuthMiddleware.php', 'Authentication middleware for Volopa platform integration']
- ['app/Http/Resources/MassPaymentFileResource.php', 'API resource transformer for mass payment files, depends on MassPaymentFile model']
- ['app/Http/Resources/PaymentInstructionResource.php', 'API resource transformer for payment instructions, depends on PaymentInstruction model']
- ['app/Http/Resources/BeneficiaryResource.php', 'API resource transformer for beneficiary data, depends on Beneficiary model']
- ['app/Http/Controllers/Api/V1/MassPaymentFileController.php', 'Main controller for mass payment operations, depends on services, requests, and resources']
- ['app/Http/Controllers/Api/V1/PaymentInstructionController.php', 'Controller for payment instruction queries, depends on services and resources']
- ['app/Http/Controllers/Api/V1/TemplateController.php', 'Controller for template downloads, depends on TemplateService and requests']
- ['routes/api.php', 'API route definitions, depends on all controllers being implemented']
- ['tests/Feature/MassPaymentFileTest.php', 'Feature tests for complete mass payment workflow, depends on all application code']

## Task list

- database/migrations/create_mass_payment_files_table.php
- database/migrations/create_payment_instructions_table.php
- app/Models/MassPaymentFile.php
- app/Models/PaymentInstruction.php
- app/Models/Beneficiary.php
- app/Models/TccAccount.php
- app/Policies/MassPaymentFilePolicy.php
- app/Http/Requests/UploadMassPaymentFileRequest.php
- app/Http/Requests/ApproveMassPaymentFileRequest.php
- app/Http/Requests/GetPaymentInstructionsRequest.php
- config/mass-payments.php
- app/Services/MassPaymentFileService.php
- app/Services/CsvValidationService.php
- app/Services/PaymentProcessingService.php
- app/Services/TemplateService.php
- app/Jobs/ValidateMassPaymentFileJob.php
- app/Jobs/ProcessPaymentInstructionsJob.php
- app/Notifications/PaymentFileApprovalNotification.php
- app/Http/Middleware/VolopaAuthMiddleware.php
- app/Http/Resources/MassPaymentFileResource.php
- app/Http/Resources/PaymentInstructionResource.php
- app/Http/Resources/BeneficiaryResource.php
- app/Http/Controllers/Api/V1/MassPaymentFileController.php
- app/Http/Controllers/Api/V1/PaymentInstructionController.php
- app/Http/Controllers/Api/V1/TemplateController.php
- routes/api.php
- tests/Feature/MassPaymentFileTest.php

## Full API spec

openapi: 3.0.0
info:
  title: Volopa Mass Payments API v5.0
  version: 1.0.0
  description: Laravel API for bulk payment processing with CSV upload
paths:
  /api/v1/mass-payment-files:
    post:
      summary: Upload mass payment file
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                tcc_account_id:
                  type: integer
      responses:
        201:
          description: File uploaded successfully
    get:
      summary: List mass payment files
      parameters:
        - name: status
          in: query
          schema:
            type: string
      responses:
        200:
          description: List of payment files
  /api/v1/mass-payment-files/{id}:
    get:
      summary: Get payment file details
      responses:
        200:
          description: Payment file details
    delete:
      summary: Delete payment file
      responses:
        204:
          description: File deleted
  /api/v1/mass-payment-files/{id}/approve:
    post:
      summary: Approve payment file
      responses:
        200:
          description: File approved
  /api/v1/payment-instructions:
    get:
      summary: List payment instructions
      parameters:
        - name: file_id
          in: query
          schema:
            type: string
      responses:
        200:
          description: List of payment instructions
  /api/v1/templates/recipients/{currency}:
    get:
      summary: Download recipient template
      responses:
        200:
          description: CSV template file
  /api/v1/templates/blank/{currency}:
    get:
      summary: Download blank template
      responses:
        200:
          description: Blank CSV template

## Shared Knowledge

All models use UUID primary keys. Multi-tenant architecture requires client_id filtering on all queries. Status enum values: draft, validating, validation_failed, awaiting_approval, approved, processing, completed, failed. CSV validation uses league/csv package. Authentication integrates with existing Volopa OAuth2/WSSE system. All monetary values stored as decimal(15,2). File upload limit is 10,000 rows per file.

## Anything UNCLEAR

OAuth2 provider configuration details for Volopa platform integration need clarification. Purpose of Payment codes structure and validation rules by country/currency combinations require definition. Real-time notification system implementation approach (WebSocket vs polling) should be determined. Specific approval workflow hierarchy rules and auto-approval thresholds need definition. Integration specifications for existing Volopa beneficiary management and payment processing APIs required.

